<p>Just as often as I find myself having to replace text in a request or response I find myself appending text to the end of the response (and sometimes the request). Usually itâ€™s some script I want to run on the page.</p>  <p>The first part is the UI portion. Pretty much its just 2 prompt boxes that have you input the text to append and then a session filter. To disable you just set the text to append to nothing.</p>  <p>The session filter uses <em>ValidUrlOrHostname</em> which can be found on the <a href="http://bgtechrants.blogspot.com/2012/02/fiddler-scripts-intro.html" target="_blank">first post</a> of this series.</p>  <pre style="border-bottom: #cecece 1px solid; border-left: #cecece 1px solid; padding-bottom: 5px; background-color: #fbfbfb; min-height: 40px; padding-left: 5px; width: 650px; padding-right: 5px; overflow: auto; border-top: #cecece 1px solid; border-right: #cecece 1px solid; padding-top: 5px"><pre style="background-color: #fbfbfb; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; font-size: 12px">  1: <span style="color: #0000ff">public</span> <span style="color: #0000ff">static</span> <span style="color: #0000ff">var</span> sTextAppendText: String = "<span style="color: #8b0000"></span>";<br /></pre><pre style="background-color: #fbfbfb; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; font-size: 12px">  2: <span style="color: #0000ff">public</span> <span style="color: #0000ff">static</span> <span style="color: #0000ff">var</span> sTextAppendHosts: String = "<span style="color: #8b0000"></span>";<br /></pre><pre style="background-color: #fbfbfb; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; font-size: 12px">  3: <span style="color: #0000ff">public</span> <span style="color: #0000ff">static</span> ToolsAction("<span style="color: #8b0000">Text Append</span>")<br /></pre><pre style="background-color: #fbfbfb; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; font-size: 12px">  4: <span style="color: #0000ff">function</span> TextAppend() {<br /></pre><pre style="background-color: #fbfbfb; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; font-size: 12px">  5: 	sTextAppendText = FiddlerObject.prompt("<span style="color: #8b0000">Enter text to append to end of documents (Empty text will clear appending):</span>", sTextAppendText);<br /></pre><pre style="background-color: #fbfbfb; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; font-size: 12px">  6: 	<span style="color: #0000ff">if</span> (sTextAppendText.Length != 0) <br /></pre><pre style="background-color: #fbfbfb; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; font-size: 12px">  7: 	{<br /></pre><pre style="background-color: #fbfbfb; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; font-size: 12px">  8: 		sTextAppendHosts = FiddlerObject.prompt("<span style="color: #8b0000">Replacment can be limited by URL or hostname\n</span>" +<br /></pre><pre style="background-color: #fbfbfb; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; font-size: 12px">  9: 							"<span style="color: #8b0000">Mutiple entries canbe made, seperate by ','\n</span>" +<br /></pre><pre style="background-color: #fbfbfb; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; font-size: 12px"> 10: 							"<span style="color: #8b0000">URLs can be exact matches or Regex matches. To use RegEx, inclose text in '/'\n</span>" +<br /></pre><pre style="background-color: #fbfbfb; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; font-size: 12px"> 11: 							"<span style="color: #8b0000">Hostname can be exact matches or subdomain matches. Hostname must begin with a '@' to signify it's a hostname and not a URL. To include subdomains of a hostname, prefix the hostname with '*.'\n</span>" +<br /></pre><pre style="background-color: #fbfbfb; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; font-size: 12px"> 12: 							"<span style="color: #8b0000">Empty text will replace on all sessions</span>", sTextAppendHosts);<br /></pre><pre style="background-color: #fbfbfb; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; font-size: 12px"> 13: 	}<br /></pre><pre style="background-color: #fbfbfb; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; font-size: 12px"> 14: }</pre></pre><br /><br /><p>Now to append text in the session response you just call this method from the <em>OnBeforeResponse</em> method, passing in the session object.</p><br /><br /><pre style="border-bottom: #cecece 1px solid; border-left: #cecece 1px solid; padding-bottom: 5px; background-color: #fbfbfb; min-height: 40px; padding-left: 5px; width: 650px; padding-right: 5px; overflow: auto; border-top: #cecece 1px solid; border-right: #cecece 1px solid; padding-top: 5px"><pre style="background-color: #fbfbfb; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; font-size: 12px">  1: <span style="color: #0000ff">static</span> <span style="color: #0000ff">function</span> OnResponseTextAppend(oSession:Session) {<br /></pre><pre style="background-color: #fbfbfb; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; font-size: 12px">  2: 	<span style="color: #0000ff">if</span> ((sTextAppendText.Length &gt; 0) &amp;&amp; ValidUrlOrHostname(sTextAppendHosts, oSession))<br /></pre><pre style="background-color: #fbfbfb; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; font-size: 12px">  3: 	{<br /></pre><pre style="background-color: #fbfbfb; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; font-size: 12px">  4: 		<span style="color: #0000ff">var</span> sTextAppendResponseBody: StringBuilder = <span style="color: #0000ff">new</span> StringBuilder();<br /></pre><pre style="background-color: #fbfbfb; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; font-size: 12px">  5: 		oSession.utilDecodeRequest(); <span style="color: #008000">// Remove any compression or chunking from the response in order to make it easier to manipulate</span><br /></pre><pre style="background-color: #fbfbfb; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; font-size: 12px">  6: 		sTextAppendResponseBody.Append(oSession.GetResponseBodyAsString()); <span style="color: #008000">// Get original body</span><br /></pre><pre style="background-color: #fbfbfb; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; font-size: 12px">  7: 		sTextAppendResponseBody.Append(sTextAppendText); <span style="color: #008000">// Append our text</span><br /></pre><pre style="background-color: #fbfbfb; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; font-size: 12px">  8: 		oSession.utilSetResponseBody(sTextAppendResponseBody.ToString()); <span style="color: #008000">// Set body as new text</span><br /></pre><pre style="background-color: #fbfbfb; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; font-size: 12px">  9: 	}<br /></pre><pre style="background-color: #fbfbfb; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; font-size: 12px"> 10: }</pre></pre><br /><br /><p>To append text in the session request you just call this method from the <em>OnBeforeRequest</em> method, passing in the session object.</p><br /><br /><pre style="border-bottom: #cecece 1px solid; border-left: #cecece 1px solid; padding-bottom: 5px; background-color: #fbfbfb; min-height: 40px; padding-left: 5px; width: 650px; padding-right: 5px; overflow: auto; border-top: #cecece 1px solid; border-right: #cecece 1px solid; padding-top: 5px"><pre style="background-color: #fbfbfb; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; font-size: 12px">  1: <span style="color: #0000ff">static</span> <span style="color: #0000ff">function</span> OnRequestTextAppend(oSession:Session) {<br /></pre><pre style="background-color: #fbfbfb; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; font-size: 12px">  2: 	<span style="color: #0000ff">if</span> ((sTextAppendText.Length &gt; 0) &amp;&amp; ValidUrlOrHostname(sTextAppendHosts, oSession))<br /></pre><pre style="background-color: #fbfbfb; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; font-size: 12px">  3: 	{<br /></pre><pre style="background-color: #fbfbfb; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; font-size: 12px">  4: 		<span style="color: #0000ff">var</span> sTextAppendRequestBody: StringBuilder = <span style="color: #0000ff">new</span> StringBuilder();<br /></pre><pre style="background-color: #fbfbfb; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; font-size: 12px">  5: 		oSession.utilDecodeRequest(); <span style="color: #008000">// Remove any compression or chunking from the response in order to make it easier to manipulate</span><br /></pre><pre style="background-color: #fbfbfb; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; font-size: 12px">  6: 		sTextAppendRequestBody.Append(oSession.GetRequestBodyAsString()); <span style="color: #008000">// Get original body</span><br /></pre><pre style="background-color: #fbfbfb; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; font-size: 12px">  7: 		sTextAppendRequestBody.Append(sTextAppendText); <span style="color: #008000">// Append our text</span><br /></pre><pre style="background-color: #fbfbfb; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; font-size: 12px">  8: 		oSession.utilSetRequestBody(sTextAppendRequestBody.ToString()); <span style="color: #008000">// Set body as new text</span><br /></pre><pre style="background-color: #fbfbfb; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; font-size: 12px">  9: 	}<br /></pre><pre style="background-color: #fbfbfb; margin: 0em; width: 100%; font-family: consolas,'Courier New',courier,monospace; font-size: 12px"> 10: }</pre></pre><br /><br /><p>One quick note about the code shown here. Both the response and request methods here use the same variable names, so unless you want to have both replace the same things on the same sessions you would need to rename the variables.</p>